!function e(t,r,a){function n(i,l){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[i]={exports:{}};t[i][0].call(u.exports,function(e){var r=t[i][1][e];return n(r?r:e)},u,u.exports,e,t,r,a)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<a.length;i++)n(a[i]);return n}({1:[function(e,t,r){"use strict";var a={container:Util.getCurrentTab(),deployPath:location.pathname.search("/publish")!==-1?"/publish":"",proxy:{read:"/publish/apply/search.do",getMembers:"/publish/user/selectAll.do",getProjects:"/publish/project/selectAll.do"},init:function(){var e=this,t=e.getSearchFormElem()[0];e.getAllMemberData(function(r){$(t.userId).select2({data:[{id:"",text:""}].concat(r),allowClear:!0,placeholder:{id:"",text:"请选择用户"}}),e.getAllProjectData(function(r){e.initTable(r),$(t.projectId).select2({data:[{id:"",text:""}].concat(r),allowClear:!0,placeholder:{id:"",text:"请选择项目"}})})}),$.datetimepicker.setLocale("zh"),$(t.startDate).datetimepicker({format:"Y-m-d",timepicker:!1,onShow:function(){var e=$(t.endDate).val();this.setOptions({maxDate:!!e&&e})}}),$(t.endDate).datetimepicker({format:"Y-m-d",timepicker:!1,onShow:function(){var e=$(t.startDate).val();this.setOptions({minDate:!!e&&e})}}),e.bindEvents()},destroy:function(){this.grid.destroy(),this.container.off(".OperateLog")},bindEvents:function(){var e=this;e.container.on("click.OperateLog",".-ser-btn",function(){return!!e.getSearchFormElem().validate("validation")&&void e.grid.reload()}),e.container.on("click.OperateLog",".-operate-log-btn",function(){setTimeout(function(){var t=e.grid.getSelectedData();t?($("#main-tab-container").data("publishOrderId",t.id),Util.menuTreeIns.select({href:e.deployPath+"/assets/fragment/publish-order-log.html"})):noty({text:"请选中条数据再操作！",type:"warning",layout:"topCenter",theme:"defaultTheme",timeout:4e3})},10)})},getSearchFormElem:function(){var e=this.container.find(".-search-form");return this.getSearchFormElem=function(){return e},e},getAllProjectData:function(e){var t=this;Util.baseAjax({url:t.proxy.getProjects,data:"self=false",complete:function(){$.isFunction(e)&&e.call(t,t.allProjects)}},function(e){e=e||{},e.success&&$.isArray(e.data)&&(t.allProjects=e.data.map(function(e){return{id:e.value,text:e.text}}))})},getAllMemberData:function(e){var t=this;Util.baseAjax({url:t.proxy.getMembers,complete:function(){$.isFunction(e)&&e.call(t,t.allMembers)}},function(e){e=e||{},e.success&&$.isArray(e.data)&&(t.allMembers=e.data.map(function(e){return{id:e.value,text:e.text}}))})},initTable:function(){var e=this;e.grid=e.container.children(".-page-container").jtable({proxy:{read:e.proxy.read},offerCommonAjax:Util.baseAjax,filterData:function(e){return e.success&&e.data?{totalCount:e.data.count,data:e.data.list}:{}},paginationQueryKey:{page:"pageCount",size:"pageSize"},queryParams:function(){return Util.parseParam(e.getSearchFormElem().serialize())},rowNumber:!0,pagination:!0,loading:{delay:500,beforeSend:function(){var t=this;e.loading=t.tableBodyContainer.loading({loader:{intervalText:["加载中 . ","加载中 . . ","加载中 . . . "],width:10,height:10,cls:"loader-circle",textCls:"fz-14px fw-b",text:"加载中..."}})},afterReceived:function(){e.loading instanceof jQuery&&e.loading.remove()}},gridHeader:{title:"发布单列表",icon:"iconfont icon-mokuaiguanlierji",toolbar:[{icon:"iconfont icon-refresh1",handle:function(e){var t=e.data;t.reload()}}]},columns:[{title:"用户",field:"userId",width:120,fixed:!0,formatter:function(t){var r=t;return $.each(e.allMembers,function(){return this.id==t&&(r=this.text),r==t}),r}},{title:"所属项目",field:"projectId",width:120,cls:"ta-l",hcls:"ta-l",formatter:function(t){var r=t;return $.each(e.allProjects,function(){return this.id==t&&(r=this.text),r==t}),r}},{title:"标题",field:"title",cls:"ta-l",hcls:"ta-l",width:120},{title:"Git 分支",field:"gitBranch",width:160},{title:"发布单状态",field:"flag",width:80,fixed:!0,formatter:function(e,t){switch(+e){case-1:return'<span style="color:red" >删除</span>';case 0:return'<span style="color: #FFBF2A" >未审核</span>';case 1:return'<span style="color:green" >正常</span>';case 2:return'<span style="color:grey" >审核未通过</span>';default:return e}}},{title:"发布状态",field:"status",width:80,formatter:function(e){switch(+e){case 0:return'<span style="color: green" >创建完成</span>';case 1:return'<span style="color: darkgreen" >更新</span>';case 2:return'<span style="color: orange" >编译通过</span>';case 3:return'<span style="color: red" >编译失败</span>';case 4:return'<span style="color: green" >同步预发成功</span>';case 5:return'<span style="color: red" >同步预发失败</span>';case 6:return'<span style="color: green" >重置预发成功</span>';case 7:return'<span style="color: red" >重置预发失败</span>';case 8:return'<span style="color: orange" >等待审核</span>';case 10:return'<span style="color: green" >线上编译成功</span>';case 11:return'<span style="color: red" >线上编译失败</span>';case 12:return'<span style="color: orange" >线上文件同步</span>';case 13:return'<span style="color: green" >线上发布成功</span>';case 15:return'<span style="color: green" >发布单已完成</span>';case 17:return'<span style="color: red" >发布单已回滚</span>';default:return e}}},{title:"创建时间",field:"gmtCreate",width:140,fixed:!0,formatter:function(e,t){return Util.Date.format(e,"yyyy-mm-dd hh:mm:ss")}},{title:"操作",width:100,fixed:!0,formatter:function(e,t){return'<a href="javascript:void(0)" class="h-line -operate-log-btn">操作日志</a>'}}]})}};a.init()},{}]},{},[1]);