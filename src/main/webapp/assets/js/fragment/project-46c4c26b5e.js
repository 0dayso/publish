!function e(t,n,i){function a(o,l){if(!n[o]){if(!t[o]){var s="function"==typeof require&&require;if(!l&&s)return s(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,n){"use strict";e("../modules/select.js");var i={container:Util.getCurrentTab(),unSetMembers:[],proxy:{read:"/publish/project/list.do",create:"/publish/project/add.do",update:"/publish/project/edit.do",delProject:"/publish/project/del.do",getMembersFromProject:"/publish/projectuser/getProjectUsers.do",editUserType:"/publish/projectuser/edit.do",delUserFromProject:"/publish/projectuser/del.do",addUserToProject:"/publish/projectuser/addBatch.do",validationProjectSetting:"/publish/shell/checkProject.do",copyProject:"/publish/project/copy.do",getMembers:"/publish/user/selectAll.do"},init:function(){var e=this;e.getAllMemberData(e.initTable),e.bindEvents(),$.validate.addRules({appNameRule:{method:function(e){return!/[^a-zA-Z.\-_]/.test(e)},message:"只能填写a-z A-Z -_ .这些字符"}})},destroy:function(){this.grid.destroy(),this.container.off(".ProjectController")},bindEvents:function(){var e=this;e.container.on("click.ProjectController",".-edit-btn",e,function(){e.grid.container.find(".-toolbar-edit-btn").trigger("click")}),e.container.on("click.ProjectController",".-ser-btn",function(){e.grid.reload()})},getSearchFormElem:function(){var e=this.container.find(".-search-form");return this.getSearchFormElem=function(){return e},e},getAllMemberData:function(e){var t=this;Util.baseAjax({url:t.proxy.getMembers,complete:function(){$.isFunction(e)&&e.call(t,t.allMembers)}},function(e){e=e||{},e.success&&$.isArray(e.data)&&(t.allMembers=e.data.map(function(e){return{id:e.value,text:e.text}}))})},setProjectDialogShow:function(e,t){0==t?e.removeClass("disabled-field").find("textarea").removeAttr("disabled"):1==t&&e.addClass("disabled-field").find("textarea").attr("disabled",!0)},initNewProjectDialog:function(e){var t=this,n=e.find(".-java-project");e.on("change.ProjectController",".-project-type",function(){t.setProjectDialogShow(n,this.value)})},loadSelect2:function(e){var t=this;t.allMembers?e.find(".-select-m").select2({placeholder:{id:"",text:"请选择"},tag:!0,data:t.allMembers}):t.getAllMemberData(function(t){e.find(".-select-m").select2({placeholder:{id:"",text:"请选择"},tag:!0,data:t})})},initTable:function(e){var t=this;t.grid=t.container.children(".-page-container").grid({proxy:{read:t.proxy.read,create:t.proxy.create,update:t.proxy.update,del:t.proxy.delProject},offerCommonAjax:Util.baseAjax,queryParams:function(){return Util.parseParam(t.getSearchFormElem().serialize())},filterData:function(e){return e.success&&e.data?{totalCount:e.data.count,data:e.data.list}:{}},toolbar:[{name:"addMembers",text:"添加成员",icon:"iconfont icon-add",handle:function(e){e.data.createDialog("addMembers")}},{name:"validation",text:"检测项目配置",icon:"iconfont icon-confirm1",handle:function(e){e.data.createDialog("validation")}},{name:"copy",text:"复制项目",icon:"iconfont icon-add01",handle:function(){var e=t.grid.getSelectedData();return e?void Util.baseAjax({url:t.proxy.copyProject,data:{id:e.id}},function(e){Util.baseSuccessTips(e,"复制成功","复制失败"),e.success&&t.grid.reload()}):(noty({text:"请选中条数据再操作！",type:"warning",layout:"topCenter",theme:"defaultTheme",timeout:4e3}),!1)}}],paginationQueryKey:{page:"pageCount",size:"pageSize"},pagination:!0,loading:{delay:500,beforeSend:function(){var e=this;t.loading=e.tableBodyContainer.loading({loader:{intervalText:["加载中 . ","加载中 . . ","加载中 . . . "],width:10,height:10,cls:"loader-circle",textCls:"fz-14px fw-b",text:"加载中..."}})},afterReceived:function(){t.loading.remove()}},gridHeader:{title:"项目信息列表",icon:"iconfont icon-mokuaiguanlierji",toolbar:[{icon:"iconfont icon-refresh1",handle:function(e){var t=e.data;t.reload()}}]},beforeCreateDialog:function(e){var t=this.getSelectedData();if("edit"===e||"delete"===e||"addMembers"===e||"validation"===e)return!t&&noty({text:"请选中条数据再操作！",type:"warning",layout:"topCenter",theme:"defaultTheme",timeout:4e3}),!!t},dialogOpts:[{name:"add",style:{width:"80%",height:"95%"},header:{title:"创建新项目",icon:"iconfont icon-user mr-5px"},content:t.container.find(".-add-dialog-template"),events:{onBeforeShow:function(e){var n=e.$bar;t.initNewProjectDialog(n)}},loadData:function(e){t.loadSelect2(e)},beforeSubmitFilterData:function(e){return e}},{name:"delete",header:{title:"确认删除项目",icon:"iconfont icon-user mr-5px"}},{name:"edit",style:{width:"80%",height:"80%"},header:{title:"修改项目",icon:"iconfont icon-user mr-5px"},content:t.container.find(".-edit-dialog-template"),events:{onBeforeShow:function(e){var n=e.$bar;t.initNewProjectDialog(n)}},loadData:function(e){var n=this.gridIns.getSelectedData()||{};t.loadSelect2(e),Util.Form.loadData(e,n),e.find(".-select-m").trigger("change"),t.setProjectDialogShow(e.find(".-java-project"),n.type)}},{name:"addMembers",header:{title:"添加新成员",icon:"iconfont icon-user mr-5px"},style:{width:"600",height:"60%"},buttons:[{text:"关闭",icon:"iconfont icon-cancel",cls:"btn btn-danger",handle:function(e){e.close()}}],content:t.container.find(".-add-member-dialog"),events:{onBeforeShow:function(e){var n=e.$bar;t.initMembersTable(n,t.grid.getSelectedData().id),n.on("click.ProjectController","#add-member",function(){var e=n.find(".-select-m").val();e&&t.addMembersToProject({userIds:e,projectId:t.grid.getSelectedData().id})}).on("click.ProjectController",".del-member",function(){t.delUserFromProject({userId:t.membersGrid.getSelectedData().userId,projectId:t.grid.getSelectedData().id})}),n.find(".-select-m").select2({placeholder:{id:"",text:"请选择项目人员"},tags:!0,data:t.allMembers})}},loadData:function(e){},beforeSubmitFilterData:function(e){return e}},{name:"validation",header:{title:"检测项目配置",icon:"iconfont icon-user mr-5px"},content:t.container.find(".-validation-dialog"),buttons:[{text:"关闭",icon:"iconfont icon-cancel",cls:"btn btn-danger",handle:function(e){e.close()}}],events:{onBeforeShow:function(e){Util.baseAjax({loading:{target:e.$bar.find(".dialog-content")},url:t.proxy.validationProjectSetting,data:{projectId:this.gridIns.getSelectedData().id}},function(t){e.$bar.find(".dialog-content").append('<div class="h-100 p-10px cor-w '+(t.success?"bg-success":"bg-error")+'">'+t.msg+"</div>")})}},beforeSubmitFilterData:function(){var e=this.gridIns.getSelectedData();return{id:e.id}}}],columns:[{title:"工程名",field:"name",width:60,hcls:"ta-l",cls:"ta-l"},{title:"标题",field:"title",width:60,hcls:"ta-l",cls:"ta-l"},{title:"环境",field:"env",width:40,fixed:!0,formatter:function(e){return e===-1?'<span style="color:green" >讯盟</span>':0===e?'<span style="color:maroon" >优办</span>':1===e?'<span style="color:red" >彩云</span>':2===e?'<span style="color:blue" >麻绳</span>':void 0}},{title:"资源类型",field:"type",width:80,fixed:!0,formatter:function(e){return 1===e?'<span style="color:green" >静态资源</span>':0===e?'<span style="color:maroon" >Java</span>':void 0}},{title:"描述",field:"descr",width:150,hcls:"ta-l",cls:"ta-l"},{title:"Git",field:"git",width:100},{title:"开发负责人",field:"ownerId",width:80,fixed:!0,formatter:function(t){var n="";return $.each(e,function(e,i){if(i.id==t)return n=i.text,!1}),n?n:t}},{title:"测试负责人",field:"testId",width:80,fixed:!0,formatter:function(t){var n="";return $.each(e,function(e,i){if(i.id==t)return n=i.text,!1}),n?n:t}}]})},renderSplitBtn:function(e,t){var n=function(e){var t='<ul class="pos-a list d-n">';return $.each(e,function(e,n){t+='<li data-val="'+n.value+'">'+n.text+"</li>"}),t+"</ul>"};return'<div class="pos-r d-ib split-btn"><div class="split-btn-body pos-r d-ib"><span class="split-text d-ib">'+e+'</span><i class="arrow d-ib"></i></div>'+n(t)+"</div>"},delUserFromProject:function(e){var t=this;Util.baseAjax({url:this.proxy.delUserFromProject,data:e},function(e){Util.baseSuccessTips(e,"删除用户成功","删除用户失败"),e.success&&t.membersGrid.reload()})},changeUserType:function(e,t){var n=this;Util.baseAjax({url:n.proxy.editUserType,type:"post",data:e},function(e){Util.baseSuccessTips(e,"修改用户类型成功","修改用户类型失败"),$.isFunction(t)&&t(e.success)})},addMembersToProject:function(e){var t=this;Util.baseAjax({url:this.proxy.addUserToProject,data:e,type:"post"},function(e){Util.baseSuccessTips(e,"添加成功","添加失败"),e.success&&t.membersGrid.reload()})},initMembersTable:function(e,t){var n=this;n.membersGrid=e.find(".-m-grid-container").jtable({proxy:{read:n.proxy.getMembersFromProject},queryParams:{projectId:t},offerCommonAjax:Util.baseAjax,rowNumbers:!0,height:180,fixedRowHeight:!1,filterData:function(e){return e.success&&e.data?{data:e.data}:{}},events:{onLoadSuccess:function(t){e.find(".split-btn").on("click",".arrow",function(){$(this).parents(".split-btn").find(".list").toggleClass("d-n")}).on("click",".list li",function(){var e=$(this),t=e.text();e.parent().addClass("d-n"),e.parents(".split-btn").find(".split-text").text(e.text()),n.changeUserType({type:e.attr("data-val"),id:n.membersGrid.getSelectedData().id},function(n){!n&&e.text(t)})})}},columns:[{title:"名字",field:"userId",formatter:function(e){var t="";return $.each(n.allMembers,function(n,i){if(i.id==e)return t=i.text,!1}),t?t:e}},{title:"类型",field:"type",formatter:function(e){var t=[{text:"用户",value:0},{text:"管理员",value:1}];return n.renderSplitBtn(0==e?"用户":1==e?"管理员":"超级管理员",t)}},{title:"操作",formatter:function(){return'<i class="del-member iconfont icon-delete cur-p" title="删除" ></i>'}}]})}};i.init()},{"../modules/select.js":2}],2:[function(e,t,n){void function(){function e(e){$.extend(!0,this,{target:null,defaultValue:null,disabled:!1,tag:!1,editable:!1,multiple:!1,cls:"",iconCls:"",queryParams:!1,proxy:"",loading:{delay:100,beforeSend:$.noop,afterReceived:$.noop},arrow:!0,offerCommonAjax:null,filterData:function(e){return e},panel:{cls:"",groupCls:"",descCls:"",itemCls:"",width:"auto"},sortBy:function(e,t){return e.text.localeCompare(t.text)},filterItem:function(e){},events:{onBeforeLoad:$.noop,onFocus:$.noop,onBlur:$.noop,onSelect:$.noop,onLoadSuccess:$.noop}},e),t.init(this)}var t={init:function(e){e.defaultCls={dSId:"-DS"+(+new Date).toString(36)+this.unique++,dSCls:"DS",lineWrap:"ds-line-wrap",lineIconContainer:"ds"+(-new Date).toString(36)+this.unique++,dsShowLine:"ds-out-show-line",arrowIcon:"ds-arrow-icon",showIcon:"ds-show-icon",textContainer:"ds-text",itemCls:"ds-option",itemTextCls:"ds-item-text",icon:"ds-itemIcon",panelCls:"ds-panel",groupCls:"ds-group",groupItemCls:"ds-group-item",descCls:"ds-desc"},e.target.addClass("d-n"),this.generateSelect(e),t.bindEvents(e)},tpls:{select:'<div id="{dSId}" class="{cls}" style="position:relative;"><div class="{lineWrap} w-100 h-100" style="position: relative;overflow: hidden"><div class="{dsShowLine} pos-a z-1" style="left:0"><i class="{icon}"></i><span class="{textContainer}"></span></div>{iconBlock}</div>{panelContent}</div>',showIconContainer:'<div class="{lineIconContainer} pos-a z-99" style="right:0">{arrowContent}{iconContent}</div>',options:'<li class="{itemCls}" data-item="{index}" data-field="{dataField}">{desc}<div class="pos-r"><a href="javascript:;" class=""><i class="{optionIcon}"></i><span class="{itemTextCls}">{text}</span></a></div></li>',panel:'<ul class="{panelCls}" style="display:none;position:absolute;">{options}</ul>',group:'<div class="{groupCls}"><div class="{groupItemCls}">{groupTitle}</div>{groupItems}</div>',desc:'<div class="{descCls}">{descText}</div>',ipt:'<input type="text" style="border:none;background: none; margin:0;padding:0; width: 100%;height: 100%;display:inline-block;color:#000; background-image: url(data:image/png;base64,)\\9;" />',arrowContent:'<i class="{arrowIcon}"></i>',icon:'<i class="{iconCls}"></i>'},generateSelect:function(e){e.selectContainer=$(this.generateSelectHtml(e)),e.panelContainer=e.selectContainer.find("."+e.defaultCls.panelCls),e.textContainer=e.selectContainer.find("."+e.defaultCls.textContainer),e.targetInput=$(this.tpls.ipt),e.dataFieldInput=$('<input type="hidden" name="'+e.target.attr("name")+'"/>'),e.textContainer.after(e.targetInput),e.target.removeAttr("name"),e.target.before(e.dataFieldInput),e.defaultValue=e.defaultValue||e.target.val(),e.defaultValue&&e.select(),e.disabled&&e.disable(),!e.editable&&e.targetInput.attr("readonly","true"),e.target.after(e.selectContainer),e.reload(e.data)},generateSelectHtml:function(e){var t=e.arrow?this.renderTpl(this.tpls.arrowContent,{arrowIcon:e.defaultCls.arrowContent}):void 0,n=e.iconCls?this.renderTpl(this.tpls.icon,{iconCls:e.iconCls}):void 0,i=t||n?this.renderTpl(this.tpls.showIconContainer,{lineIconContainer:e.defaultCls.lineIconContainer,arrowContent:t,iconContent:n}):void 0;return this.renderTpl(this.tpls.select,{dSId:e.defaultCls.dSId,dsShowLine:e.defaultCls.dsShowLine,cls:e.defaultCls.dSCls+e.cls,icon:e.defaultCls.icon,iconBlock:i,textContainer:e.defaultCls.textContainer,panelContent:this.generatePanelHtml(e)})},generatePanelHtml:function(e){return this.renderTpl(this.tpls.panel,{panelCls:e.defaultCls.panelCls+" "+e.panel.cls,options:this.generateGroupHtml(e,e.data)})},generateGroupHtml:function(e,t){var n,i="",a=0;if(!$.isArray(t)||!(n=t.length))return this.renderTpl(this.tpls.options,{itemCls:e.defaultCls.itemCls+" "+e.panel.itemCls,itemTextCls:e.defaultCls.itemTextCls,text:"无数据"});for(;a<n;++a)i+=$.isPlainObject(t.group)?this.renderTpl(this.tpls.group,{groupCls:e.defaultCls.groupCls+" "+e.panel.groupCls,groupItemCls:e.defaultCls.groupItemCls,groupTitle:t[a].group.title,groupItems:this.generateOptionsHtml(e,t[a].group.data)}):this.generateOptionsHtml(e,[t[a]]);return i},generateOptionsHtml:function(e,t){var n,i="",a=0;if(!$.isArray(t)||!(n=t.length))return"";for(;a<n;++a)i+=this.renderTpl(this.tpls.options,{itemCls:e.defaultCls.itemCls+" "+e.panel.itemCls,text:t[a].text,itemTextCls:e.defaultCls.itemTextCls,dataField:t[a].value,index:a,optionIcon:t[a].icon,desc:void 0==t[a].desc?this.renderTpl(this.tpls.desc,{descCls:e.panel.descCls,descText:t[a].desc}):""});return i},bindEvents:function(e){var t=!1,n=200,i=0,a=function(r){return setTimeout(function(){t||i>n?(t=!1,i=0,e.events.onBlur.call(e.selectContainer,r),!e.multiple&&e.panelContainer.css("display","none")):(i+=50,a(r))},50),!1};e.selectContainer.on("click.DSelect",e,function(t){return!e.disabled&&(e.panelContainer.css("display","block"),e.targetInput.focus(),!1)}).on("click.DSelect","."+e.defaultCls.itemCls,function(){var n=$(this);return t=!0,e.targetInput.val(n.find("."+e.defaultCls.itemTextCls).text()),e.dataFieldInput.val(n.attr("data-field")),e.multiple?n.addClass("disabled"):e.panelContainer.css("display","none"),!1}).on({"blur.DSelect":a,"focus.DSelect":function(t){return e.events.onFocus.call(e.selectContainer,t),!1},"keyup.DSelect":function(t){if(!e.editable)return!1;var n=this.value;return window.clearTimeout(e.updateTimer),e.updateTimer=setTimeout(function(){e.update(e.data,n)},50),!1}},"input")},unique:1,renderTpl:function(e,t){var n={};return e.replace(/\{[^\{\}]*\}/g,function(e){var i=$.trim(e.slice(1,-1)),a=t[i];return $.isArray(a)?(void 0==n[i]?n[i]=0:n[i]+=1,a[n[i]]):void 0==a?"":a})},getRemoteData:function(e){var t=this,n={},i="string"==typeof t.proxy?{url:t.proxy}:t.proxy;$.isFunction(t.queryParams)?$.extend(n,t.queryParams()):$.isPlainObject(t.queryParams)&&$.extend(n,t.queryParams),"string"==typeof t.queryParams&&(n=t.queryParams+"&"+$.param(n)),t.offerCommonAjax($.extend(!0,{},i,{data:n,dataType:"json",complete:function(t){var n=t.responseJSON;if(n=n||{},$.isFunction(e)&&e(n),$.isFunction(i.complete))return i.complete.apply(this,arguments)}}))},filterDataArr:function(e,t){if(!$.isArray(e)||!e.length||void 0==t||""==t)return e;for(var n=0,i=e.length,a=[];n<i;++n)e[n].text.toLowerCase().indexOf(t.toLowerCase())!==-1&&a.push(e[n]);return a},sortData:function(e,t,n){if(!$.isArray(t)||!t.length)return t;for(var i=0,a=t.length,r=[],o=[];i<a;++i)$.isPlainObject(t[i].group)&&$.isArray(t[i].group.data)?r.push(this.filterDataArr(t[i].group.data,n).sort(e.sortBy)):o.push(t[i]);return r.concat(this.filterDataArr(o,n).sort(e.sortBy))},resizeShowLine:function(e){var t=e.selectContainer.children(this.defaultCls.lineWrap).width(),n=e.selectContainer.find("."+this.defaultCls.lineIconContainer).width(),i=e.selectContainer.find("."+this.defaultCls.dsShowLine),a=t-n-i.width();a<0&&i.css("left",a)}};$.extend(e.prototype,{doLayout:function(){var e=this,t=parseFloat(e.selectContainer.height()),n=parseFloat(e.selectContainer.outerHeight(!0)),i=n>0?n:parseFloat(e.selectContainer.css("min-height"));e.panelContainer.css({top:i-1-parseFloat(e.selectContainer.css("border-bottom-width")),left:"-1px"}),e.selectContainer.css("height",t>0?t:i)},getValue:function(){return this.dataFieldInput.val()},getSelectedItemData:function(){return this.data&&this.data[this.panelContainer.find("li.selected").attr("data-item")]},disable:function(){var e=this;e.targetInput.attr("disabled",!0),e.selectContainer.addClass("disabled"),e.disabled=!0},select:function(e){var t=this;t.panelContainer.find("li."+t.defaultCls.itemCls).each(function(){var n=$(this);n.removeClass("selected"),e==n.attr("data-field")&&n.addClass("selected")&&t.dataFieldInput.val(e)})},update:function(e,n){e=t.sortData(this,e||this.data,n),this.panelContainer.html(t.generateGroupHtml(this,e))},reload:function(e){var t=this,n=function(e){t.data=t.filterData(e),t.events.onBeforeLoad.call(t),t.update(t.data),t.events.onLoadSuccess.call(t,t.data),clearTimeout(t.loadingTimer),!t.loadingTimer&&t.loading.afterReceived.call(t),t.lockGenerate=!1,t.doLayout()};return!t.lockGenerate&&(t.lockGenerate=!0,void(e?n(e):$.isFunction(t.offerCommonAjax)?(t.loading&&(t.loadingTimer=setTimeout(function(){t.loading.beforeSend.call(t),t.loadingTimer=void 0},t.loading.delay)),t.getRemoteData(n)):n(t.data)))}}),$.fn.dselect=function(t){var n=[];return this.length>1?(this.each(function(){t.target=$(this),n.push(new e(t))}),n):(t.target=this,new e(t))}}()},{}]},{},[1]);