!function(e){e.Grid=function(t){this.options=t,e.extend(!0,this,{container:null,columns:null,source:!1,curpage:1,pageSize:20,height:!1,minHeight:100,fixedRowHeight:!0,rowNumber:!1,hasCheckbox:!1,checkboxValueField:"",pagination:!1,proxy:{read:""},queryParams:{},paginationQueryKey:{page:"currentPage",size:"pageSize"},offerCommonAjax:!1,loading:{delay:100,beforeSend:e.noop,afterReceived:e.noop},filterData:function(e){return e},toolbar:!1,gridHeader:!1,events:{onBeforeLoad:e.noop,onLoadSuccess:e.noop,onRowClick:e.noop,onRowDbClick:e.noop},customEvents:!1},t),this.init()};var t={tpls:{icon:'<a href="javascript:void(0);"><i class="{icon}"></i></a>',toolbar:'<a href="{href}" class="btn {className} {cls}">\t\t\t\t\t\t\t\t<i class="{icon}"></i>\t\t\t\t\t\t\t\t<span class="" >{text}</span>\t\t\t\t\t\t\t</a>',gridHeader:'<div class="fl-l {cls}">\t\t\t\t\t\t\t\t<i class="{icon}"></i>\t\t\t\t\t\t\t\t<span class="fw-b">{title}</span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="grid-header-toolbar fl-r">{toolIcon}</div>',tableTr:'<tr data-rowData="{rowNum}" class="{rowStrip} {gridRowCls}">{tdHtml}</tr>',tableTd:'<td data-field="{field}" class="{gridCellCls}" ><div class="{cls} {fieldCls}">{text}</div></td>',rowNumber:'<td class="{numCls}"><div>{serialNum}</div></td>',hasCheckbox:'<td class="{checkboxCellCls}"><div><input type="checkbox" class="{checkboxCls}" name="{name}" value="{valueField}" /></div></td>'},renderTpl:function(t,i){var a={};return t.replace(/\{[^\}]*\}/g,function(t){var n=e.trim(t.slice(1,-1)),r=i[n];return e.isArray(r)?(void 0==a[n]?a[n]=0:a[n]+=1,r[a[n]]):void 0==r?"":r})}};e.extend(e.Grid.prototype,{init:function(){var e=this;e.defaultCls={numCls:"row-number-cell",checkboxCellCls:"checkbox-cell",checkboxCls:"grid-checkbox",selectId:"row-selectAll"+(+new Date).toString(36),gridCellCls:"grid-cell",gridCellPreCls:"grid-td-"+(+new Date).toString(36),gridRowCls:"grid-row"},e.layoutSize={containerWidth:0,fixedWidth:0,dynamicFields:[],dynamicWidth:0,rate:1},e.container.addClass("jq-grid"),e.initGridHeader(),e.initToolbar(),e.initTableHeader(),e.reload(e.source),e.bindEvents(),e.customEvents&&e.addListeners(e.customEvents)},initGridHeader:function(){var i,a=this,n=[],r=[],l="",d=0;if(!a.gridHeader)return!1;if(e.isArray(a.gridHeader.toolbar))for(i=a.gridHeader.toolbar.length;d<i;++d)l+=t.tpls.icon,r.push(a.gridHeader.toolbar[d].icon+" -grid-header-toolbar"+d),n.push({target:".-grid-header-toolbar"+d,emit:"click.Table",handle:a.gridHeader.toolbar[d].handle||e.noop,delegate:a.container});return a.gridHeaderConatiner||(a.gridHeaderConatiner=e('<div class="cf grid-header"></div>'),a.container.append(a.gridHeaderConatiner)),a.gridHeaderConatiner.html(t.renderTpl(t.tpls.gridHeader,{cls:a.gridHeader.cls,title:a.gridHeader.title,icon:a.gridHeader.icon,toolIcon:t.renderTpl(l,{icon:r})})),a.addListeners(n),!0},initToolbar:function(){var i,a=this,n=[],r="",l=0;if(!e.isArray(a.toolbar))return!1;for(i=a.toolbar.length;l<i;++l)r+=t.renderTpl(t.tpls.toolbar,{text:a.toolbar[l].text,icon:a.toolbar[l].icon,cls:a.toolbar[l].cls,className:"-toolbar-btn"+l,href:a.toolbar[l].href||"javascript:void(0);"}),n.push({target:".-toolbar-btn"+l,emit:"click.Table",handle:a.toolbar[l].handle||e.noop,data:a,delegate:a.container});return a.container.append('<div class="toolbar-container">'+r+"</div>"),a.addListeners(n),!0},initTableHeader:function(){var t="";t+=this.height?+this.height?"height:"+this.height+"px;":"height:"+this.height+";":"",t+=this.minHeight?+this.minHeight?"min-height:"+this.minHeight+"px;":"min-height:"+this.minHeight+";":"",this.tableContainer=e('<div class="jq-table"></div>'),this.tableContainer.append('<div class="grid-table-header">'+this.generateHeaderHtml()+"</div>"),this.tableBodyContainer=e('<div class="grid-table-body"'+(t?'style="'+t+'"':"")+"></div>"),this.tableContainer.append(this.tableBodyContainer),this.container.append(this.tableContainer)},addListeners:function(t){var i,a,n=this,r=0;for(!e.isArray(t)&&(t=[t]),i=t.length;r<i;++r)t[r].delegate?(a=n.getJQElem(t[r].delegate),a.length&&a.on(t[r].emit,t[r].target,t[r].data||n,t[r].handle)):(a=n.getJQElem(t[r].target),a.length&&a.on(t[r].emit,t[r].data||n,t[r].handle))},indexOfElem:function(t,i){var a=-1;return e.each(t,function(e){if(this[0]===i[0])return a=e,!1}),a},getJQElem:function(t){var i=this.container.find(t);return!i.length&&(i=e(t)),i},getData:function(){return this.source.data||[]},getSelectedData:function(){var t=this.container.find("tr.selected").attr("data-rowData");if(e.isNumeric(t))return this.getData()[t]},getCurrentPageIndex:function(){return this.curpage},generateHeaderHtml:function(){var t,i,a=this,n=a.columns,r=e.extend({},a.defaultCls),l="",d="",o=!0,s=0;if(!e.isArray(n))return"";for(l+="<table><thead><tr>",a.rowNumber&&(l+='<th class="'+r.numCls+'"><div style="width: 30px" ></div></th>',a.layoutSize.fixedWidth+=31),a.hasCheckbox&&(l+='<th class="'+r.checkboxCellCls+'"><div style="width: 30px" ><input type="checkbox" id="'+r.selectId+'" /></div></th>',a.layoutSize.fixedWidth+=31),i=n.length;s<i;s++)t=n[s].field||(n[s].field=(+new Date).toString(36)+s),l+='<th data-field="'+t+'" ><div class="'+r.gridCellPreCls+t+(s==i-1?" grid-header-last ":" ")+(n[s].hcls||"")+'">'+(n[s].title||"")+"</div></th>",n[s].fixed&&+n[s].width?(a.layoutSize.fixedWidth+=+n[s].width,d+=a.generateFieldStyle(t,n[s].width)):(a.layoutSize.dynamicFields.push({field:t,width:n[s].width||"auto"}),a.layoutSize.dynamicWidth+=+n[s].width?+n[s].width:o=0);return 0===o&&(a.layoutSize.dynamicFields=e.grep(a.layoutSize.dynamicFields,function(e,t){return"auto"===e.width||(d+=a.generateFieldStyle(e.field,e.width),!1)})),a.tableContainer.prepend('<style class="fixed-style" type="text/css">'+d+"</style>"),l+="</tr></thead></table>",a.resize(),l},resizeLayoutSize:function(t){var i=this;if(i.tableBodyContainer)i.layoutSize.containerWidth=i.tableBodyContainer[0].clientWidth;else{if(!i.gridHeaderConatiner)return!1;i.layoutSize.containerWidth=i.gridHeaderConatiner[0].clientWidth}!t&&e.each(i.layoutSize.dynamicFields,function(e,i){return t="auto"===i.width,!t}),t?(i.layoutSize.fixedWidth+=i.layoutSize.dynamicWidth,i.layoutSize.dynamicWidth=0,i.layoutSize.rate=Math.round((i.layoutSize.containerWidth-i.layoutSize.fixedWidth)/i.layoutSize.dynamicFields.length)):i.layoutSize.rate=(i.layoutSize.containerWidth-i.layoutSize.fixedWidth)/i.layoutSize.dynamicWidth},generateListHtml:function(){var t,i=this,a=i.source,n=a.data,r="<table><tbody>",l=0;if(e.isArray(n)&&n.length)for(t=n.length;l<t;++l)r+=i.generateTr(n[l],l);else r='<table width="100%"><tbody><tr><td class="'+i.defaultCls.gridCellCls+'" align="center">暂无数据</td></tr>';return r+="</tbody></table>"},generateTable:function(){var e=this;e.tableBodyContainer.html(e.generateListHtml()),e.pagination&&e.generatePagination()},generatePagination:function(){var t=this,i=t.source;e.isArray(i.data)&&i.data.length&&(t.paginationContainer||(t.paginationContainer=e('<div class="grid-pagination cf" style="margin-top: 10px"></div>'),t.container.append(t.paginationContainer)),t.paginationContainer.pagination(i.totalCount,{items_per_page:t.pageSize,num_display_entries:8,current_page:t.curpage-1,num_edge_entries:1,prev_text:"上一页",next_text:"下一页",jump_page:!0,callback:function(e){t.curpage=e,t.reload()}}))},generateTr:function(i,a){var n,r,l=this,d=l.columns,o="",s=e.extend(!0,{},l.defaultCls,{rowNum:a,serialNum:a+1,rowStrip:a%2?"even":"odd",valueField:i[l.checkboxValueField],name:l.checkboxValueField}),c=0;for(l.rowNumber&&(o+=t.renderTpl(t.tpls.rowNumber,s)),l.hasCheckbox&&(o+=t.renderTpl(t.tpls.hasCheckbox,s));c<d.length;c++)r=d[c].field,n=(d[c].formatter||e.noop)(i[r],i),o+=t.renderTpl(t.tpls.tableTd,{gridCellCls:l.defaultCls.gridCellCls,fieldCls:l.defaultCls.gridCellPreCls+(r||"")+(l.fixedRowHeight?" fixed-height":" ww-bw"),cls:d[c].cls,text:void 0==n?i[r]:n,field:r});return s.tdHtml=o,t.renderTpl(t.tpls.tableTr,s)},generateFieldStyle:function(e,t){return".jq-table ."+this.defaultCls.gridCellPreCls+e+"{width:"+(+t?t+"px":t)+";margin-left:0;margin-right:0;padding-left:0;padding-right:0;}"},bindEvents:function(){var t=this;e(window).on("resize.Table",t,function(){t.container.resizeTable||(t.container.resizeTable=!0,setTimeout(function(){t.resize(),t.container.resizeTable=!1},100))}),t.addListeners([{target:"#"+t.defaultCls.selectId,emit:"click.Table",delegate:t.container,data:[t,t.defaultCls.checkboxCls],handle:function(t){var i=t.data[0];i.container.find("."+t.data[1]).prop("checked",e(this).prop("checked"))}},{target:"."+t.defaultCls.checkboxCls,emit:"click.Table",delegate:t.container,data:[t,t.defaultCls.selectId,t.defaultCls.checkboxCls],handle:function(e){var t=e.data[0],i=t.container.find("."+e.data[2]);t.container.find("#"+e.data[1]).prop("checked",i.length===i.filter(":checked").length)}},{target:"."+t.defaultCls.gridRowCls,emit:"click.Table",delegate:t.container,data:[t,t.defaultCls.gridRowCls],handle:function(i){e(this).addClass("selected").siblings("."+i.data[1]).removeClass("selected"),t.events.onRowClick.call(this,i)}},{target:"."+t.defaultCls.gridRowCls,emit:"dblclick.Table",delegate:t.container,data:[t,t.defaultCls.gridRowCls],handle:function(e){t.events.onRowDbClick.call(this,e)}}])},getRemoteData:function(t){var i=this,a={},n="string"==typeof i.proxy.read?{url:i.proxy.read}:i.proxy.read;e.isFunction(i.queryParams)?e.extend(a,i.queryParams()):e.isPlainObject(i.queryParams)&&e.extend(a,i.queryParams),i.pagination&&(a[i.paginationQueryKey.page]=i.curpage,a[i.paginationQueryKey.size]=i.pageSize),"string"==typeof i.queryParams&&(a=i.queryParams+"&"+e.param(a)),i.offerCommonAjax(e.extend(!0,{},n,{data:a,dataType:"json",complete:function(i){var a=i.responseJSON;if(a=a||{},e.isFunction(t)&&t(a),e.isFunction(n.complete))return n.complete.apply(this,arguments)}}))},reload:function(t){var i=this,a=function(e){i.source=i.filterData(e),i.events.onBeforeLoad.call(i),i.generateTable(),i.resize(),i.events.onLoadSuccess.call(i,i.source),clearTimeout(i.loadingTimer),!i.loadingTimer&&i.loading.afterReceived.call(i),i.lockGridGenerate=!1};return!i.lockGridGenerate&&(i.lockGridGenerate=!0,void(t?a(t):e.isFunction(i.offerCommonAjax)?(i.loading&&(i.loadingTimer=setTimeout(function(){i.loading.beforeSend.call(i),i.loadingTimer=void 0},i.loading.delay)),i.getRemoteData(a)):a(i.source)))},getCheckedSerialValues:function(){return this.container.find("."+this.defaultCls.checkboxCls+":checked").serialize()},getCheckedValues:function(){var e=[];return this.container.find("."+this.defaultCls.checkboxCls+":checked").each(function(){e.push(this.value)}),e},resize:function(){var t,i=this,a="";return(!i.tableBodyContainer||i.tableBodyContainer[0].clientWidth!==i.layoutSize.containerWidth)&&(i.resizeLayoutSize(),e.each(i.layoutSize.dynamicFields,function(e,n){t=Math.floor(10*(+n.width?n.width*i.layoutSize.rate:1*i.layoutSize.rate))/10-1,a+=i.generateFieldStyle(n.field,t)}),i.tableContainer.find("style.dynamic-style").remove(),void i.tableContainer.prepend('<style class="dynamic-style" type="text/css">'+a+"</style>"))},destroy:function(){this.container.off(".Table"),this.container.removeClass("jq-grid").html("")},toggleRowHeight:function(e){e.find("."+this.defaultCls.gridCellCls+">div").toggleClass("fixed-height")},setRowHeightFixed:function(e){e.find("."+this.defaultCls.gridCellCls+">div").addClass("fixed-height")},setRowHeightAuto:function(e){e.find("."+this.defaultCls.gridCellCls+">div").removeClass("fixed-height")}}),e.fn.jtable=function(t){return t.container=this,new e.Grid(t)}}(jQuery);